name: Automatic Change Detection & Helena Task Assignment (Manual Only)

on:
  # Manual trigger only - NO auto-push to repo
  workflow_dispatch:

jobs:
  detect-changes:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Full history for git comparison
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Run automatic change detection
        run: |
          python3 scripts/auto_detect_changes_and_assign.py
      
      - name: Upload Helena tasks as artifact
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: helena-tasks
          path: |
            helena_tasks/
            .change_tracking_state.json
          retention-days: 30
      
      - name: Summary
        if: success()
        run: |
          echo "‚úÖ Automatic monitoring completed"
          echo "üìä Helena tasks generated (download from Artifacts)"
          echo "‚ö†Ô∏è  NO AUTO-PUSH - You control when to commit"
          
          if [ -d "helena_tasks" ] && [ "$(ls -A helena_tasks)" ]; then
            echo ""
            echo "Generated tasks:"
            ls -lh helena_tasks/ | tail -10
          fi
