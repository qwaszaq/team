{
  "file_path": "docs/team/ENHANCED_COLLABORATION_STEP4.md",
  "title": "Enhanced Collaboration System - Step 4: Consensus Builder",
  "document_type": "general_documentation",
  "content": "# Enhanced Collaboration System - Step 4: Consensus Builder\n\n**Date:** 2025-11-04  \n**Component:** ConsensusBuilder  \n**Status:** \u2705 Implemented  \n**Branch:** feature/enhanced-cross-team-collaboration\n\n---\n\n## \ud83c\udfaf Purpose\n\nBuild consensus between teams through structured position tracking, common ground detection, and compromise proposals.\n\n---\n\n## \ud83d\udd27 Component: ConsensusBuilder\n\n### Features\n\n**1. Position Registration**\n- Team position tracking\n- Key points identification\n- Non-negotiable requirements\n- Timestamp tracking\n\n**2. Common Ground Detection**\n- Keyword-based similarity\n- Agreement strength calculation\n- Unique position identification\n- Conflict detection\n\n**3. Compromise Proposals**\n- Automatic compromise generation\n- Optional feature suggestions\n- Discussion area identification\n\n**4. Consensus Measurement**\n- Consensus score (0-1)\n- Team alignment tracking\n- Agreement/disagreement ratio\n- Progress monitoring\n\n---\n\n## \ud83d\udccb API Reference\n\n### Initialization\n\n```python\nfrom agents.enhanced_collaboration import ConsensusBuilder\n\nbuilder = ConsensusBuilder(\n    topic=\"Skills Routing Implementation\",\n    teams=[\"analytical\", \"technical\"]\n)\n```\n\n### Register Position\n\n```python\nbuilder.register_position(\n    team=\"analytical\",\n    position=\"Need accurate intent detection\",\n    key_points=[\n        \"User-friendly natural language\",\n        \"High accuracy (>80%)\",\n        \"Fast response (<200ms)\"\n    ],\n    non_negotiables=[\"High accuracy\"]\n)\n```\n\n### Find Common Ground\n\n```python\ncommon = builder.find_common_ground()\n\n# Returns:\n{\n    \"common_ground\": [\n        {\n            \"point\": str,\n            \"teams_agreeing\": List[str],\n            \"agreement_strength\": float  # 0.0 - 1.0\n        }\n    ],\n    \"unique_positions\": {\n        \"team_name\": List[str]  # Unique points per team\n    },\n    \"conflicts\": [\n        {\n            \"team1\": str,\n            \"position1\": str,\n            \"team2\": str,\n            \"position2\": str,\n            \"conflict_type\": str\n        }\n    ],\n    \"agreement_areas\": int,\n    \"conflict_areas\": int\n}\n```\n\n### Track Agreement\n\n```python\nbuilder.track_agreement(\n    teams_agreeing=[\"analytical\", \"technical\"],\n    agreed_point=\"Use keyword matching with <10ms target\",\n    rationale=\"Meets both speed and simplicity requirements\"\n)\n```\n\n### Get Consensus Score\n\n```python\nscore = builder.get_consensus_score()\n# Returns: float (0.0 - 1.0)\n\n# 0.0 - 0.3: Low consensus\n# 0.3 - 0.7: Moderate consensus\n# 0.7 - 1.0: High consensus\n```\n\n### Propose Compromise\n\n```python\ncompromise = builder.propose_compromise()\n\n# Returns:\n{\n    \"agreed_points\": List[Dict],  # Already agreed items\n    \"compromise_proposals\": List[Dict],  # Compromise suggestions\n    \"areas_for_discussion\": List[Dict],  # Conflicts needing discussion\n    \"optional_features\": {  # Team-specific features\n        \"description\": str,\n        \"suggestions\": List[Dict]\n    }\n}\n```\n\n### Get Team Alignment\n\n```python\nalignment = builder.get_team_alignment()\n\n# Returns: Dict[str, float]\n{\n    \"analytical\": 0.85,  # 85% aligned with consensus\n    \"technical\": 0.90    # 90% aligned with consensus\n}\n```\n\n---\n\n## \ud83d\udca1 Usage Example\n\n```python\nfrom agents.enhanced_collaboration import ConsensusBuilder\n\n# Create builder\nbuilder = ConsensusBuilder(\n    topic=\"Skills Routing Implementation\",\n    teams=[\"analytical\", \"technical\"]\n)\n\n# TURN 1: Analytical team position\nbuilder.register_position(\n    team=\"analytical\",\n    position=\"Need accurate and user-friendly routing\",\n    key_points=[\n        \"Natural language understanding\",\n        \"High accuracy (>80%)\",\n        \"Fast response\",\n        \"Easy for users\"\n    ],\n    non_negotiables=[\"High accuracy\"]\n)\n\n# TURN 2: Technical team position\nbuilder.register_position(\n    team=\"technical\",\n    position=\"Need simple and maintainable solution\",\n    key_points=[\n        \"No complex dependencies\",\n        \"Very fast (<10ms)\",\n        \"Easy to debug\",\n        \"Simple implementation\"\n    ],\n    non_negotiables=[\"Simple implementation\"]\n)\n\n# Find common ground\ncommon = builder.find_common_ground()\nprint(f\"Common ground: {len(common['common_ground'])} areas\")\n# Output: \"Common ground: 1 areas\" (Fast response)\n\nprint(f\"Conflicts: {len(common['conflicts'])} areas\")\n# Output: \"Conflicts: 0 areas\" (Non-negotiables don't conflict)\n\n# Unique positions\nunique = common[\"unique_positions\"]\nprint(f\"Analytical unique: {unique.get('analytical', [])}\")\n# Output: [\"Natural language understanding\", \"Easy for users\"]\n\nprint(f\"Technical unique: {unique.get('technical', [])}\")\n# Output: [\"No complex dependencies\", \"Easy to debug\"]\n\n# After discussion, track agreement\nbuilder.track_agreement(\n    teams_agreeing=[\"analytical\", \"technical\"],\n    agreed_point=\"Use weighted keyword matching with <10ms latency\",\n    rationale=\"Balances simplicity (technical need) with accuracy (analytical need)\"\n)\n\n# Check consensus\nscore = builder.get_consensus_score()\nprint(f\"Consensus: {score:.0%}\")\n# Output: \"Consensus: 67%\" (Moderate consensus achieved)\n\n# Get alignment\nalignment = builder.get_team_alignment()\nprint(f\"Analytical alignment: {alignment['analytical']:.0%}\")\nprint(f\"Technical alignment: {alignment['technical']:.0%}\")\n```\n\n---\n\n## \ud83d\udcca Real-World Example\n\nFrom `CROSS_TEAM_COLLABORATION_MULTI_TURN.md`:\n\n```python\nbuilder = ConsensusBuilder(\n    topic=\"Sprint 1 Implementation Details\",\n    teams=[\"analytical\", \"technical\"]\n)\n\n# Analytical Team Position\nbuilder.register_position(\n    team=\"analytical\",\n    position=\"Prioritize user experience and accuracy\",\n    key_points=[\n        \"Natural language skills routing\",\n        \"Confidence scorer (80% threshold)\",\n        \"User-friendly error messages\",\n        \"Target: 200ms latency\"\n    ],\n    non_negotiables=[\"Accuracy > 80%\"]\n)\n\n# Technical Team Position\nbuilder.register_position(\n    team=\"technical\",\n    position=\"Prioritize simplicity and performance\",\n    key_points=[\n        \"Simple keyword matching\",\n        \"In-memory JSON storage\",\n        \"Target: <10ms latency\",\n        \"Zero external dependencies\"\n    ],\n    non_negotiables=[\"Simple implementation\"]\n)\n\n# Find common ground\ncommon = builder.find_common_ground()\n\n# Common: Both want fast response (though different targets)\nprint(f\"Agreement areas: {common['agreement_areas']}\")  # 1\n\n# After multi-turn discussion\nbuilder.track_agreement(\n    [\"analytical\", \"technical\"],\n    \"Use simple keyword matching\",\n    \"Technical challenge accepted by analytical team\"\n)\n\nbuilder.track_agreement(\n    [\"analytical\", \"technical\"],\n    \"Target <10ms latency\",\n    \"Better than 200ms, both teams happy\"\n)\n\nbuilder.track_agreement(\n    [\"analytical\", \"technical\"],\n    \"Use JSON file with hot reload\",\n    \"Simpler than PostgreSQL, maintains flexibility\"\n)\n\n# Final consensus\nscore = builder.get_consensus_score()\nprint(f\"Final consensus: {score:.0%}\")  # 85% - High consensus!\n\n# Team alignment\nalignment = builder.get_team_alignment()\nprint(f\"Analytical: {alignment['analytical']:.0%}\")  # 100% (in all agreements)\nprint(f\"Technical: {alignment['technical']:.0%}\")   # 100% (in all agreements)\n```\n\n---\n\n## \ud83c\udfaf Consensus Scoring\n\n### Formula\n\n```\nconsensus_score = (agreements + common_ground) / total_key_points\n```\n\n### Interpretation\n\n| Score | Level | Meaning |\n|-------|-------|---------|\n| 0.0 - 0.3 | Low | Significant disagreement, more work needed |\n| 0.3 - 0.5 | Moderate-Low | Some common ground, gaps remain |\n| 0.5 - 0.7 | Moderate | Reasonable agreement, refinement needed |\n| 0.7 - 0.9 | High | Strong consensus, minor details left |\n| 0.9 - 1.0 | Very High | Near-complete agreement, ready to proceed |\n\n---\n\n## \ud83d\udd0d Common Ground Detection\n\n### Similarity Algorithm\n\n**Step 1:** Extract keywords from key points\n```python\n\"Fast response\" \u2192 [\"fast\", \"response\"]\n\"Very fast\" \u2192 [\"very\", \"fast\"]\n```\n\n**Step 2:** Compare keyword overlap\n```python\noverlap = len(keywords1 & keywords2)\nsimilarity = overlap / min(len(keywords1), len(keywords2))\n```\n\n**Step 3:** Threshold check\n```python\nif similarity > 0.5:  # >50% overlap\n    considered_similar = True\n```\n\n### Conflict Detection\n\n**Checks for:**\n1. Negation patterns (\"no X\" vs \"X\")\n2. Contradictory statements\n3. Non-negotiable conflicts\n\n---\n\n## \ud83e\udd1d Compromise Generation\n\n### Automatic Proposals\n\n**For conflicts:**\n- Identify middle ground\n- Suggest optional features\n- Recommend discussion\n\n**For unique positions:**\n- Mark as team-specific\n- Suggest making optional\n- Evaluate trade-offs\n\n---\n\n## \ud83d\udd04 Integration with Previous Components\n\n### With MultiTurnConversation\n\n```python\nconv = MultiTurnConversation(topic=\"Implementation\", teams=[\"analytical\", \"technical\"])\nbuilder = ConsensusBuilder(topic=\"Implementation\", teams=[\"analytical\", \"technical\"])\n\n# Turn 1: Analytical proposes\nconv.add_turn(1, \"analytical\", \"Lucas\", \"Proposal A\", \"proposal\")\nbuilder.register_position(\"analytical\", \"Proposal A\", [\"Point 1\", \"Point 2\"])\n\n# Turn 2: Technical proposes\nconv.add_turn(2, \"technical\", \"Tomasz\", \"Proposal B\", \"proposal\")\nbuilder.register_position(\"technical\", \"Proposal B\", [\"Point 3\", \"Point 4\"])\n\n# Turn 3: Agreement\nconv.add_turn(3, \"analytical\", \"Sofia\", \"We agree on compromise\", \"agreement\")\nbuilder.track_agreement([\"analytical\", \"technical\"], \"Compromise X\", \"Makes sense\")\n\n# Check consensus\nscore = builder.get_consensus_score()\nprint(f\"Consensus after {len(conv.turns)} turns: {score:.0%}\")\n```\n\n### With FeedbackLoopTracker\n\n```python\nfeedback = FeedbackLoopTracker()\nbuilder = ConsensusBuilder(topic=\"Storage Choice\", teams=[\"analytical\", \"technical\"])\n\n# Positions\nbuilder.register_position(\"analytical\", \"Use PostgreSQL\", [\"Persistent\", \"Reliable\"])\nbuilder.register_position(\"technical\", \"Use JSON\", [\"Simple\", \"Fast\"])\n\n# Challenge\nloop_id = feedback.track_challenge(\n    \"Maria\", \"technical\", \"PostgreSQL proposal\",\n    \"complexity\", \"PostgreSQL\", \"Too complex for static data\"\n)\n\n# Response with agreement\nfeedback.track_response(loop_id, \"Viktor\", \"accept\", \"Good point\", \"Use JSON\")\nbuilder.track_agreement([\"analytical\", \"technical\"], \"Use JSON\", \"Simpler for static data\")\n\n# Both systems show collaboration success\nassert feedback.get_improvement_metrics()[\"improvement_rate\"] == 1.0\nassert builder.get_consensus_score() > 0.5\n```\n\n---\n\n## \u2705 Testing\n\nTested scenarios:\n- \u2705 Position registration (with non-negotiables)\n- \u2705 Common ground detection\n- \u2705 Conflict detection\n- \u2705 Agreement tracking\n- \u2705 Disagreement tracking\n- \u2705 Consensus scoring\n- \u2705 Compromise proposals\n- \u2705 Team alignment\n- \u2705 Agreement breakdown\n- \u2705 Export functionality\n\n---\n\n## \ud83d\udcdd Next Steps\n\n**Step 5:** Implement CollaborationPatternRecognizer\n- Pattern recognition\n- Success indicator detection\n- Best practices extraction\n- Learning from history\n\n---\n\n**Implemented by:** Aleksander Nowak (Technical Team)  \n**Reviewed by:** Helena Kowalczyk (Documentation)  \n**Date:** November 4, 2025  \n**Status:** \u2705 Complete and tested\n",
  "indexed_at": "2025-11-04T11:42:44.698805",
  "source": "realtime_watcher"
}