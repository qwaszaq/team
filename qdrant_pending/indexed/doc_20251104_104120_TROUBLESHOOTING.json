{
  "file_path": "docs/guides/TROUBLESHOOTING.md",
  "title": "\ud83d\udd27 Troubleshooting Guide - Helena Auto-Execution System",
  "document_type": "general_documentation",
  "content": "# \ud83d\udd27 Troubleshooting Guide - Helena Auto-Execution System\n\n**Common issues and their solutions**\n\n---\n\n## \ud83d\udccb Table of Contents\n\n1. [Watcher Issues](#watcher-issues)\n2. [Qdrant Issues](#qdrant-issues)\n3. [Database Connection Issues](#database-connection-issues)\n4. [Environment Issues](#environment-issues)\n5. [Performance Issues](#performance-issues)\n6. [Common Error Messages](#common-error-messages)\n\n---\n\n## \ud83d\udd0d Watcher Issues\n\n### Watcher Not Starting\n\n**Symptoms:**\n- `./start_watcher_conda.sh` runs but no process visible\n- No log output in `logs/watcher.log`\n\n**Diagnosis:**\n```bash\n# Check if process is running\nps aux | grep realtime_md_watcher\n\n# Check logs for errors\ncat logs/watcher.log\ncat logs/watcher_error.log\n```\n\n**Solutions:**\n\n1. **Conda environment not activated:**\n```bash\nconda activate team\n./start_watcher_conda.sh\n```\n\n2. **Missing watchdog package:**\n```bash\nconda activate team\nconda install watchdog\n```\n\n3. **Permission issues:**\n```bash\nchmod +x start_watcher_conda.sh\nchmod +x scripts/realtime_md_watcher.py\n```\n\n4. **Port/file already in use:**\n```bash\n# Kill existing watcher\npkill -f realtime_md_watcher\n\n# Wait 2 seconds\nsleep 2\n\n# Restart\n./start_watcher_conda.sh\n```\n\n---\n\n### Files Not Being Detected\n\n**Symptoms:**\n- Save a `.md` file but watcher doesn't react\n- No queue files created in `helena_tasks/realtime_queue/`\n\n**Diagnosis:**\n```bash\n# Check if watcher is running\nps aux | grep realtime_md_watcher\n\n# Check recent log output\ntail -20 logs/watcher.log\n\n# Manually test file detection\necho \"# Test\" > docs/status/test_detection.md\nsleep 2\ntail -10 logs/watcher.log\n```\n\n**Solutions:**\n\n1. **File saved outside monitored directory:**\n   - **Problem:** Only `docs/` directory is monitored\n   - **Solution:** Save files in `docs/` subdirectories\n\n2. **File too small (<200 bytes):**\n```bash\n# Check file size\nls -lh docs/your_file.md\n\n# Add more content\necho \"\n\n## More Content\n\nThis makes the file larger than 200 bytes.\n\n\" >> docs/your_file.md\n```\n\n3. **Filename contains exclusion keywords:**\n   - **Problem:** Files with \"test\", \"demo\", \"example\" in name are excluded\n   - **Solution:** Rename file without these keywords\n\n4. **Watcher crashed:**\n```bash\n# Check for crash in logs\ntail -50 logs/watcher.log | grep -i error\n\n# Restart watcher\npkill -f realtime_md_watcher\n./start_watcher_conda.sh\n```\n\n---\n\n### Watcher Crashes Repeatedly\n\n**Symptoms:**\n- Watcher starts but stops after few seconds\n- Error messages in logs\n\n**Diagnosis:**\n```bash\n# Check error log\ncat logs/watcher_error.log\n\n# Run watcher in foreground for debugging\nconda run -n team python scripts/realtime_md_watcher.py\n```\n\n**Solutions:**\n\n1. **Module import errors:**\n```bash\nconda activate team\nconda install watchdog qdrant-client psycopg2-binary neo4j redis\n```\n\n2. **Path errors:**\n   - Check that PROJECT_ROOT in scripts matches your actual path\n   - Default: `/Users/artur/coursor-agents-destiny-folder`\n\n3. **Permission errors:**\n```bash\n# Fix permissions\nchmod -R u+w helena_tasks/\nchmod -R u+w logs/\nchmod -R u+w qdrant_pending/\n```\n\n---\n\n## \ud83d\uddc4\ufe0f Qdrant Issues\n\n### Documents Not Appearing in Dashboard\n\n**Symptoms:**\n- Watcher detects file\n- Processing completes\n- But document not visible in Qdrant dashboard\n\n**Diagnosis:**\n```bash\n# Check Qdrant is running\ncurl -s http://localhost:6333/collections/destiny-team-framework-master | python3 -m json.tool\n\n# Check current point count\ncurl -s http://localhost:6333/collections/destiny-team-framework-master \\\n  | python3 -c \"import json,sys; print('Points:', json.load(sys.stdin)['result']['points_count'])\"\n\n# Check for pending documents\nls -l qdrant_pending/doc_*.json\n```\n\n**Solutions:**\n\n1. **Vector dimension mismatch:**\n```bash\n# Verify collection uses 1024 dimensions\ncurl -s http://localhost:6333/collections/destiny-team-framework-master \\\n  | python3 -c \"import json,sys; print(json.load(sys.stdin)['result']['config']['params']['vectors'])\"\n\n# Should output: {'size': 1024, 'distance': 'Cosine'}\n\n# If mismatch, check helena_realtime_processor_simple.py\ngrep -n \"1024\" scripts/helena_realtime_processor_simple.py\n```\n\n2. **qdrant-client not available:**\n```bash\nconda activate team\nconda install qdrant-client\n\n# Verify\npython -c \"from qdrant_client import QdrantClient; print('\u2705 OK')\"\n```\n\n3. **Indexing failed silently:**\n```bash\n# Check processor logs in watcher.log\ngrep \"Qdrant\" logs/watcher.log | tail -10\n\n# Look for \"\u2705 INDEXED\" vs \"\u26a0\ufe0f Indexing failed\"\n```\n\n4. **Pending documents not indexed:**\n```bash\n# Manually batch index\nconda run -n team python scripts/index_all_pending_qdrant.py\n```\n\n---\n\n### \"Dimension Mismatch\" Error\n\n**Symptoms:**\n```\nError: Vector dimension mismatch!\nExpected: 1024, Got: 384\n```\n\n**Diagnosis:**\n```bash\n# Check vector generation code\ngrep -A 10 \"generate_embedding\" scripts/helena_realtime_processor_simple.py\n```\n\n**Solution:**\n\n**CRITICAL:** Helena MUST use 1024 dimensions!\n\n```python\n# \u2705 CORRECT - 1024 dimensions\nhash_obj = hashlib.sha512(text.encode())\nhash_bytes = hash_obj.digest()\n\nembedding = []\nfor i in range(1024):\n    byte_val = hash_bytes[i % len(hash_bytes)]\n    embedding.append((byte_val / 127.5) - 1.0)\n\n# len(embedding) == 1024 \u2705\n```\n\nSee [HELENA_VECTOR_1024_REQUIREMENT.md](../protocols/HELENA_VECTOR_1024_REQUIREMENT.md)\n\n---\n\n## \ud83d\udd0c Database Connection Issues\n\n### PostgreSQL Connection Failed\n\n**Symptoms:**\n```\n\u26a0\ufe0f  DB execution failed: could not connect to server\n```\n\n**Diagnosis:**\n```bash\n# Check if PostgreSQL is running\ndocker ps | grep postgres\n\n# Test connection\npsql -h localhost -U user -d destiny_team -c \"SELECT 1;\"\n```\n\n**Solutions:**\n\n1. **Container not running:**\n```bash\ndocker start hercules-postgres\n# or\ndocker start sms-postgres\n```\n\n2. **Wrong credentials in config:**\n   - Check `DB_CONFIG['postgres']` in `helena_realtime_processor_simple.py`\n   - Default: `user:password@localhost:5432/destiny_team`\n\n3. **Database doesn't exist:**\n```bash\n# Create database\npsql -h localhost -U user -c \"CREATE DATABASE destiny_team;\"\n```\n\n4. **Table 'documents' doesn't exist:**\n   - SQL file will be generated as backup\n   - Create table manually or run migration scripts\n\n**Graceful Fallback:** Even if PostgreSQL is unavailable, SQL files are saved in `sql/realtime_updates/`\n\n---\n\n### Neo4j Connection Failed\n\n**Symptoms:**\n```\n\u26a0\ufe0f  DB execution failed: ServiceUnavailable\n```\n\n**Diagnosis:**\n```bash\n# Check if Neo4j is running\ndocker ps | grep neo4j\n\n# Test connection\ncurl http://localhost:7474\n```\n\n**Solutions:**\n\n1. **Container not running:**\n```bash\ndocker start sms-neo4j\n```\n\n2. **Wrong credentials:**\n   - Check `DB_CONFIG['neo4j']` in processor\n   - Default: `neo4j:password@bolt://localhost:7687`\n\n3. **Cypher syntax error:**\n   - Check generated Cypher files in `sql/realtime_updates/`\n   - Look for single quote escaping issues\n\n**Graceful Fallback:** Cypher files saved in `sql/realtime_updates/` for manual execution\n\n---\n\n### Redis Connection Failed\n\n**Symptoms:**\n```\n\u26a0\ufe0f  Execution failed: Connection refused\n```\n\n**Diagnosis:**\n```bash\n# Check if Redis is running\ndocker ps | grep redis\n\n# Test connection\ndocker exec kg-redis redis-cli PING\n# Should return: PONG\n```\n\n**Solutions:**\n\n1. **Container not running:**\n```bash\ndocker start kg-redis\n```\n\n2. **Wrong host/port:**\n   - Check `DB_CONFIG['redis']` in processor\n   - Default: `localhost:6379, db=0`\n\n**Graceful Fallback:** Redis commands saved in `redis_pending/` for manual execution\n\n---\n\n## \ud83d\udc0d Environment Issues\n\n### \"ModuleNotFoundError\"\n\n**Symptoms:**\n```\nModuleNotFoundError: No module named 'qdrant_client'\nModuleNotFoundError: No module named 'watchdog'\n```\n\n**Diagnosis:**\n```bash\n# Check active environment\nconda env list | grep '*'\n\n# List installed packages\nconda list | grep -E \"qdrant|watchdog|psycopg2|neo4j|redis\"\n```\n\n**Solutions:**\n\n1. **Wrong conda environment:**\n```bash\n# Activate correct environment\nconda activate team\n\n# Verify\nwhich python\n# Should output: /opt/miniconda3/envs/team/bin/python\n```\n\n2. **Packages not installed:**\n```bash\nconda activate team\nconda install watchdog qdrant-client psycopg2-binary neo4j redis\n```\n\n3. **Using system Python instead of conda:**\n```bash\n# Check watcher startup script\ncat start_watcher_conda.sh\n\n# Should use: conda run -n team python ...\n```\n\n---\n\n### \"ImportError: cannot import name...\"\n\n**Symptoms:**\n```\nImportError: cannot import name 'PointStruct' from 'qdrant_client.models'\n```\n\n**Solution:**\n\n**Version mismatch:**\n```bash\nconda activate team\n\n# Update to compatible versions\nconda install qdrant-client=1.15.1\nconda install neo4j=6.0.2\nconda install redis=7.0.1\n```\n\n---\n\n## \u26a1 Performance Issues\n\n### Slow Processing (>30 seconds)\n\n**Symptoms:**\n- File detected quickly but processing takes long\n- \"Processing...\" message in logs for extended time\n\n**Diagnosis:**\n```bash\n# Check processor execution time in logs\ngrep \"Total time:\" logs/watcher.log | tail -5\n```\n\n**Solutions:**\n\n1. **Large file content:**\n   - Files >10MB may take longer\n   - Consider splitting into smaller documents\n\n2. **Database slow:**\n```bash\n# Check database container resources\ndocker stats --no-stream\n\n# Increase memory/CPU if needed\n```\n\n3. **Network latency:**\n   - Check localhost connections are not proxied\n   - Verify no firewall blocking localhost\n\n---\n\n### High Memory Usage\n\n**Symptoms:**\n- Watcher process using >1GB RAM\n- System slowdown\n\n**Diagnosis:**\n```bash\n# Check memory usage\nps aux | grep realtime_md_watcher | awk '{print $4 \"%\", $6/1024 \"MB\"}'\n```\n\n**Solutions:**\n\n1. **Too many pending documents:**\n```bash\n# Clear processed documents\nmv helena_tasks/realtime_queue/*.json helena_tasks/processed/\n\n# Batch index pending Qdrant\nconda run -n team python scripts/index_all_pending_qdrant.py\n```\n\n2. **Memory leak:**\n```bash\n# Restart watcher daily via cron\n0 4 * * * pkill -f realtime_md_watcher && sleep 5 && /path/to/start_watcher_conda.sh\n```\n\n---\n\n## \ud83d\udea8 Common Error Messages\n\n### \"relation 'documents' does not exist\"\n\n**Meaning:** PostgreSQL table not created\n\n**Solution:**\n```sql\n-- Create table manually\nCREATE TABLE IF NOT EXISTS documents (\n    file_path TEXT PRIMARY KEY,\n    document_type TEXT,\n    title TEXT,\n    content_preview TEXT,\n    line_count INTEGER,\n    created_at TIMESTAMP,\n    indexed_at TIMESTAMP,\n    source TEXT\n);\n```\n\nOr use generated SQL files from `sql/realtime_updates/`\n\n---\n\n### \"ServiceUnavailable: Failed to establish connection\"\n\n**Meaning:** Neo4j not accessible\n\n**Solution:**\n```bash\n# Start Neo4j\ndocker start sms-neo4j\n\n# Wait for startup\nsleep 10\n\n# Verify\ncurl http://localhost:7474\n```\n\n---\n\n### \"vector dimension mismatch\"\n\n**Meaning:** Vector is not 1024 dimensions\n\n**Solution:** See [Vector Dimension Requirement](#vector-dimension-mismatch-error)\n\n---\n\n### \"Not significant enough for database propagation\"\n\n**Meaning:** File too small or contains excluded keywords\n\n**Solution:**\n- Add more content (>200 bytes)\n- Avoid \"test\", \"demo\", \"example\" in filename\n- Check logs for specific reason:\n```bash\ngrep \"Not significant\" logs/watcher.log | tail -5\n```\n\n---\n\n## \ud83d\udcde Quick Diagnostic Commands\n\n```bash\n# System Status Check\necho \"=== WATCHER STATUS ===\"\nps aux | grep realtime_md_watcher | grep -v grep && echo \"\u2705 Running\" || echo \"\u274c Not running\"\n\necho -e \"\\n=== CONDA ENVIRONMENT ===\"\nconda env list | grep team\n\necho -e \"\\n=== DATABASE CONTAINERS ===\"\ndocker ps | grep -E \"qdrant|postgres|neo4j|redis\"\n\necho -e \"\\n=== QDRANT STATUS ===\"\ncurl -s http://localhost:6333/collections/destiny-team-framework-master \\\n  | python3 -c \"import json,sys; r=json.load(sys.stdin)['result']; print(f\\\"Points: {r['points_count']}, Vector size: {r['config']['params']['vectors']['size']}\\\")\"\n\necho -e \"\\n=== RECENT LOGS ===\"\ntail -10 logs/watcher.log\n\necho -e \"\\n=== PENDING TASKS ===\"\necho \"Helena queue: $(ls helena_tasks/realtime_queue/*.json 2>/dev/null | wc -l)\"\necho \"Qdrant pending: $(ls qdrant_pending/doc_*.json 2>/dev/null | wc -l)\"\n```\n\n---\n\n## \ud83c\udd98 Emergency Recovery\n\nIf nothing works:\n\n```bash\n# 1. Stop everything\npkill -f realtime_md_watcher\n\n# 2. Clear queues\nmkdir -p helena_tasks/emergency_backup\nmv helena_tasks/realtime_queue/*.json helena_tasks/emergency_backup/ 2>/dev/null\n\n# 3. Verify environment\nconda activate team\nconda install watchdog qdrant-client psycopg2-binary neo4j redis\n\n# 4. Test databases\ndocker ps | grep -E \"qdrant|postgres|neo4j|redis\"\n\n# 5. Restart clean\n./start_watcher_conda.sh\n\n# 6. Monitor logs\ntail -f logs/watcher.log\n```\n\n---\n\n## \ud83d\udcda See Also\n\n- [README.md](../../README.md) - Quick start guide\n- [HELENA_VECTOR_1024_REQUIREMENT.md](../protocols/HELENA_VECTOR_1024_REQUIREMENT.md) - Vector requirements\n- [AUTOMATIC_DATABASE_EXECUTION_PROTOCOL.md](../protocols/AUTOMATIC_DATABASE_EXECUTION_PROTOCOL.md) - Execution protocol\n\n---\n\n**Need more help?** Check the logs:\n- `logs/watcher.log` - Main watcher log\n- `logs/watcher_error.log` - Error output\n- Helena task files in `helena_tasks/` - Processing details\n\n---\n\n*Built with resilience in mind. Every error has a solution!* \ud83d\udd27\n",
  "indexed_at": "2025-11-04T10:41:20.346305",
  "source": "realtime_watcher"
}