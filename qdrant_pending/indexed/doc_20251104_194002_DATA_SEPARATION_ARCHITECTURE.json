{
  "file_path": "docs/architecture/DATA_SEPARATION_ARCHITECTURE.md",
  "title": "\ud83c\udfd7\ufe0f DATA SEPARATION ARCHITECTURE",
  "document_type": "architecture",
  "content": "# \ud83c\udfd7\ufe0f DATA SEPARATION ARCHITECTURE\n## Separacja Danych Projektowych od Danych Investigacyjnych\n\n**Date:** 2025-11-04  \n**Critical Requirement:** Dane projektowe NIE MOG\u0104 miesza\u0107 si\u0119 z danymi roboczymi agent\u00f3w  \n**Status:** Design Complete - Ready for Implementation  \n\n---\n\n## \ud83c\udfaf PROBLEM\n\n**Current State:**\n- Wszystkie dane w jednym folderze (`docs/`)\n- Bazy danych u\u017cywaj\u0105 tych samych kolekcji/schemat\u00f3w\n- Ryzyko mieszania si\u0119 danych projektowych z danymi investigacyjnymi\n- Brak czystej separacji mi\u0119dzy \"system knowledge\" a \"investigation data\"\n\n**Risk:**\n- \ud83d\udd34 Investigation data zanieczyszcza project knowledge base\n- \ud83d\udd34 Agenci mog\u0105 przeszukiwa\u0107 project files zamiast investigation sources\n- \ud83d\udd34 Backup/recovery complications (wszystko razem)\n- \ud83d\udd34 Privacy concerns (investigation data mo\u017ce by\u0107 wra\u017cliwe)\n\n---\n\n## \u2705 SOLUTION: Complete Data Separation\n\n### **Principle:** Two Completely Separate Data Universes\n\n```\nUNIVERSE 1: PROJECT DATA\n\u2514\u2500\u2500 System knowledge, documentation, code, architecture\n    \u2514\u2500\u2500 For: System operation, development, team knowledge\n    \u2514\u2500\u2500 Storage: /docs/, project collections in DBs\n\nUNIVERSE 2: INVESTIGATION DATA  \n\u2514\u2500\u2500 Research sources, findings, evidence, analysis\n    \u2514\u2500\u2500 For: Agent work, investigations, analysis\n    \u2514\u2500\u2500 Storage: /investigations/, investigation collections in DBs\n\nNO MIXING. EVER.\n```\n\n---\n\n## \ud83d\udcc1 FILESYSTEM STRUCTURE\n\n### **Current Structure (Mixed):**\n\n```\n/Users/artur/coursor-agents-destiny-folder/\n\u251c\u2500\u2500 docs/                    # \ud83d\udd34 MIXED: Project + some investigation\n\u251c\u2500\u2500 helena_tasks/            # Project\n\u251c\u2500\u2500 logs/                    # Mixed\n\u251c\u2500\u2500 agents/                  # Project code\n\u2514\u2500\u2500 investigations/          # Investigation data (isolated but needs more structure)\n```\n\n### **New Structure (Separated):**\n\n```\n/Users/artur/coursor-agents-destiny-folder/\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PROJECT UNIVERSE (System Knowledge)                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u251c\u2500\u2500 docs/                              # PROJECT ONLY\n\u2502   \u251c\u2500\u2500 architecture/                  # System architecture\n\u2502   \u251c\u2500\u2500 protocols/                     # System protocols\n\u2502   \u251c\u2500\u2500 guides/                        # User guides\n\u2502   \u251c\u2500\u2500 team/                          # Team docs\n\u2502   \u251c\u2500\u2500 capabilities/                  # System capabilities\n\u2502   \u2514\u2500\u2500 concepts/                      # Design concepts\n\u2502\n\u251c\u2500\u2500 agents/                            # Agent code (PROJECT)\n\u251c\u2500\u2500 orchestration/                     # Orchestration code (PROJECT)\n\u251c\u2500\u2500 scripts/                           # System scripts (PROJECT)\n\u251c\u2500\u2500 helena_tasks/                      # Helena queue (PROJECT)\n\u2502\n\u2514\u2500\u2500 logs/system/                       # SYSTEM LOGS ONLY\n    \u251c\u2500\u2500 helena/\n    \u251c\u2500\u2500 database/\n    \u2514\u2500\u2500 errors/\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  INVESTIGATION UNIVERSE (Research Data)                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u2514\u2500\u2500 investigations/                    # INVESTIGATION DATA ONLY\n    \u251c\u2500\u2500 active/                        # Current investigations\n    \u2502   \u251c\u2500\u2500 {investigation_id}/\n    \u2502   \u2502   \u251c\u2500\u2500 sources/               # Collected sources\n    \u2502   \u2502   \u2502   \u251c\u2500\u2500 web/               # Web pages (archived)\n    \u2502   \u2502   \u2502   \u251c\u2500\u2500 documents/         # PDFs, docs\n    \u2502   \u2502   \u2502   \u251c\u2500\u2500 images/            # Images, screenshots\n    \u2502   \u2502   \u2502   \u2514\u2500\u2500 data/              # CSV, JSON, datasets\n    \u2502   \u2502   \u251c\u2500\u2500 analysis/              # Analysis files\n    \u2502   \u2502   \u2502   \u251c\u2500\u2500 OSINT_report.md\n    \u2502   \u2502   \u2502   \u251c\u2500\u2500 financial_analysis.md\n    \u2502   \u2502   \u2502   \u2514\u2500\u2500 timeline.json\n    \u2502   \u2502   \u251c\u2500\u2500 interim_results/       # Work-in-progress\n    \u2502   \u2502   \u251c\u2500\u2500 metadata.json          # Investigation metadata\n    \u2502   \u2502   \u2514\u2500\u2500 README.md              # Investigation overview\n    \u2502   \u2502\n    \u2502   \u2514\u2500\u2500 {another_investigation_id}/\n    \u2502\n    \u251c\u2500\u2500 completed/                     # Finished investigations\n    \u2502   \u2514\u2500\u2500 {investigation_id}/        # Same structure as active\n    \u2502\n    \u251c\u2500\u2500 archived/                      # Old investigations (compressed)\n    \u2502\n    \u2514\u2500\u2500 templates/                     # Investigation templates\n        \u251c\u2500\u2500 investigation_template/\n        \u2514\u2500\u2500 source_template.md\n\n\u2514\u2500\u2500 logs/investigations/               # INVESTIGATION LOGS ONLY\n    \u251c\u2500\u2500 local_llm/                     # LLM execution logs\n    \u2502   \u2514\u2500\u2500 investigation_{id}_{timestamp}.jsonl\n    \u251c\u2500\u2500 supervisor/                    # Supervisor review logs\n    \u2502   \u2514\u2500\u2500 review_{id}_{timestamp}.json\n    \u2514\u2500\u2500 tool_usage/                    # Tool execution logs\n        \u2514\u2500\u2500 tools_{id}_{timestamp}.log\n\n\u2514\u2500\u2500 shared_workspace/                  # INVESTIGATION WORKSPACE\n    \u251c\u2500\u2500 tasks/                         # Investigation tasks\n    \u251c\u2500\u2500 results/                       # Investigation results\n    \u251c\u2500\u2500 guidance/                      # Supervisor guidance\n    \u2514\u2500\u2500 reports/                       # Quality reports\n```\n\n---\n\n## \ud83d\uddc4\ufe0f DATABASE SEPARATION\n\n### **1. QDRANT - Separate Collections**\n\n**Current:** Single collection `destiny-team-framework-master`\n\n**New:** Separate collections with clear prefixes\n\n```python\n# PROJECT COLLECTIONS (System Knowledge)\nCOLLECTION_PROJECT_DOCS = \"destiny_project_documentation\"\n# Contains: Architecture, guides, protocols, team docs\n# Embedding: text-embedding-intfloat-multilingual-e5-large-instruct\n# TTL: None (permanent)\n\nCOLLECTION_PROJECT_CODE = \"destiny_project_code\"\n# Contains: Agent code, scripts, system code\n# Embedding: jina-embeddings-v4-text-retrieval (code-optimized)\n# TTL: None (permanent)\n\n# INVESTIGATION COLLECTIONS (Research Data)\nCOLLECTION_INVESTIGATION_SOURCES = \"destiny_investigation_sources\"\n# Contains: Web pages, articles, documents collected during investigations\n# Embedding: text-embedding-intfloat-multilingual-e5-large-instruct (standard text)\n# TTL: 90 days (or until investigation archived)\n\nCOLLECTION_INVESTIGATION_FINANCIAL = \"destiny_investigation_financial\"\n# Contains: Financial reports, PDFs with tables, structured financial data\n# Embedding: jina-embeddings-v4-text-retrieval (table-optimized)\n# TTL: 90 days (or until investigation archived)\n\nCOLLECTION_INVESTIGATION_ANALYSIS = \"destiny_investigation_analysis\"\n# Contains: Agent analysis, findings, reports\n# Embedding: text-embedding-intfloat-multilingual-e5-large-instruct\n# TTL: 180 days (longer retention for analysis)\n```\n\n**Collection Metadata:**\n\n```python\n{\n    \"name\": \"destiny_investigation_sources\",\n    \"metadata\": {\n        \"universe\": \"investigation\",\n        \"purpose\": \"Research sources collected during investigations\",\n        \"embedding_model\": \"text-embedding-intfloat-multilingual-e5-large-instruct\",\n        \"ttl_days\": 90,\n        \"auto_archive\": true,\n        \"investigation_namespace\": true\n    }\n}\n```\n\n---\n\n### **2. POSTGRESQL - Separate Schemas**\n\n**Current:** Tables in public schema\n\n**New:** Separate schemas\n\n```sql\n-- PROJECT SCHEMA\nCREATE SCHEMA project;\n\n-- Project tables\nCREATE TABLE project.documentation (\n    id SERIAL PRIMARY KEY,\n    file_path TEXT NOT NULL,\n    title TEXT,\n    category TEXT,\n    created_at TIMESTAMP DEFAULT NOW(),\n    updated_at TIMESTAMP DEFAULT NOW(),\n    content_hash TEXT,\n    metadata JSONB\n);\n\nCREATE TABLE project.agents (\n    id SERIAL PRIMARY KEY,\n    agent_name TEXT NOT NULL,\n    role TEXT,\n    capabilities JSONB,\n    status TEXT,\n    updated_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE TABLE project.capabilities (\n    id SERIAL PRIMARY KEY,\n    capability_name TEXT NOT NULL,\n    category TEXT,\n    status TEXT,\n    documentation_path TEXT,\n    metadata JSONB\n);\n\n-- INVESTIGATION SCHEMA\nCREATE SCHEMA investigation;\n\n-- Investigation tables\nCREATE TABLE investigation.investigations (\n    id TEXT PRIMARY KEY,  -- investigation_id\n    title TEXT NOT NULL,\n    objective TEXT,\n    status TEXT,  -- active, completed, archived\n    created_at TIMESTAMP DEFAULT NOW(),\n    completed_at TIMESTAMP,\n    assigned_agents TEXT[],\n    metadata JSONB\n);\n\nCREATE TABLE investigation.sources (\n    id SERIAL PRIMARY KEY,\n    investigation_id TEXT REFERENCES investigation.investigations(id),\n    source_url TEXT,\n    source_type TEXT,  -- web, document, image, data\n    file_path TEXT,\n    archived_at TIMESTAMP DEFAULT NOW(),\n    credibility TEXT,  -- high, medium, low\n    metadata JSONB\n);\n\nCREATE TABLE investigation.findings (\n    id SERIAL PRIMARY KEY,\n    investigation_id TEXT REFERENCES investigation.investigations(id),\n    finding_type TEXT,  -- fact, timeline, financial, legal\n    content TEXT,\n    confidence TEXT,  -- high, medium, low\n    sources_ids INTEGER[],  -- References to sources\n    verified BOOLEAN DEFAULT FALSE,\n    created_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE TABLE investigation.quality_reports (\n    id SERIAL PRIMARY KEY,\n    investigation_id TEXT REFERENCES investigation.investigations(id),\n    supervisor TEXT,  -- \"Aleksander\"\n    overall_grade TEXT,\n    tool_usage_grade TEXT,\n    source_quality_grade TEXT,\n    ready_for_publication BOOLEAN,\n    report_data JSONB,\n    created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n**Access Control:**\n\n```sql\n-- Project schema: Full access for system\nGRANT ALL ON SCHEMA project TO destiny_system;\n\n-- Investigation schema: Access for agents + supervisor\nGRANT ALL ON SCHEMA investigation TO destiny_agents;\nGRANT SELECT ON SCHEMA investigation TO destiny_supervisor;\n```\n\n---\n\n### **3. NEO4J - Separate Label Namespaces**\n\n**Current:** All nodes mixed\n\n**New:** Separate label prefixes\n\n```cypher\n// PROJECT NODES (System Knowledge)\n(:Project:Documentation {path, title, category})\n(:Project:Agent {name, role, capabilities})\n(:Project:Capability {name, category, status})\n(:Project:Tool {name, type, version})\n\n// Relationships\n(:Project:Agent)-[:HAS_CAPABILITY]->(:Project:Capability)\n(:Project:Agent)-[:USES_TOOL]->(:Project:Tool)\n(:Project:Documentation)-[:DESCRIBES]->(:Project:Capability)\n\n// INVESTIGATION NODES (Research Data)\n(:Investigation {id, title, status, created_at})\n(:Investigation:Source {url, type, credibility, archived_path})\n(:Investigation:Finding {type, content, confidence})\n(:Investigation:Entity {name, type})  // People, organizations, places\n(:Investigation:Event {description, date, location})\n\n// Relationships\n(:Investigation)-[:HAS_SOURCE]->(:Investigation:Source)\n(:Investigation)-[:PRODUCED_FINDING]->(:Investigation:Finding)\n(:Investigation:Finding)-[:CITES]->(:Investigation:Source)\n(:Investigation:Entity)-[:MENTIONED_IN]->(:Investigation:Source)\n(:Investigation:Event)-[:INVOLVED]->(:Investigation:Entity)\n```\n\n**Query Isolation:**\n\n```cypher\n// Project queries\nMATCH (a:Project:Agent)-[:HAS_CAPABILITY]->(c:Project:Capability)\nRETURN a, c\n\n// Investigation queries (completely separate)\nMATCH (i:Investigation)-[:HAS_SOURCE]->(s:Investigation:Source)\nWHERE i.id = $investigation_id\nRETURN i, s\n```\n\n---\n\n### **4. REDIS - Separate Key Prefixes**\n\n**Current:** Mixed keys\n\n**New:** Separate namespaces\n\n```python\n# PROJECT KEYS\nKEY_PREFIX_PROJECT = \"project:\"\n\n# Examples:\n\"project:agent:elena:status\"\n\"project:capability:scraping:version\"\n\"project:doc:architecture:hash\"\n\"project:cache:capabilities_registry\"\n\n# INVESTIGATION KEYS\nKEY_PREFIX_INVESTIGATION = \"inv:\"\n\n# Examples:\n\"inv:telus_cpk:status\"\n\"inv:telus_cpk:sources:count\"\n\"inv:telus_cpk:quality:grade\"\n\"inv:telus_cpk:cache:timeline\"\n\n# TTL policies\n# Project keys: No TTL (permanent)\n# Investigation keys: TTL = 7 days (refreshed on access)\n```\n\n---\n\n## \ud83d\udd27 EMBEDDING MODEL ROUTING\n\n### **Intelligent Embedding Selection**\n\n```python\nclass EmbeddingRouter:\n    \"\"\"\n    Route documents to appropriate embedding model\n    Based on content type and characteristics\n    \"\"\"\n    \n    # Models configuration\n    MODELS = {\n        \"standard_text\": {\n            \"name\": \"text-embedding-intfloat-multilingual-e5-large-instruct\",\n            \"endpoint\": \"http://localhost:1234/v1/embeddings\",\n            \"use_for\": [\"text\", \"articles\", \"reports_no_tables\", \"web_content\"],\n            \"dimensions\": 1024,\n            \"context_window\": 512\n        },\n        \"financial_tables\": {\n            \"name\": \"jina-embeddings-v4-text-retrieval\",\n            \"endpoint\": \"http://localhost:1234/v1/embeddings\",\n            \"use_for\": [\"financial_pdf\", \"tables\", \"structured_data\", \"spreadsheets\"],\n            \"dimensions\": 768,\n            \"context_window\": 8192\n        }\n    }\n    \n    def detect_document_type(self, content: str, metadata: dict) -> str:\n        \"\"\"\n        Detect document type to select appropriate embedding model\n        \n        Returns: \"standard_text\" or \"financial_tables\"\n        \"\"\"\n        # Check metadata first\n        if metadata.get(\"type\") == \"financial\":\n            return \"financial_tables\"\n        \n        if metadata.get(\"has_tables\", False):\n            return \"financial_tables\"\n        \n        # Content analysis\n        indicators_financial = [\n            \"PLN\", \"USD\", \"EUR\", \"z\u0142\",  # Currencies\n            \"bilans\", \"rachunek\", \"wynik finansowy\",  # Financial terms PL\n            \"balance sheet\", \"income statement\",  # Financial terms EN\n            \"|\", \"\u2500\u2500\u2500\", \"\u250c\", \"\u2514\",  # Table characters\n        ]\n        \n        financial_count = sum(\n            1 for indicator in indicators_financial\n            if indicator.lower() in content.lower()\n        )\n        \n        # If 3+ financial indicators, use financial model\n        if financial_count >= 3:\n            return \"financial_tables\"\n        \n        # Check for table structures\n        lines = content.split('\\n')\n        table_lines = sum(1 for line in lines if '|' in line or '\\t\\t' in line)\n        \n        if table_lines > 5:  # More than 5 lines with table indicators\n            return \"financial_tables\"\n        \n        # Default: standard text model\n        return \"standard_text\"\n    \n    def get_embedding(\n        self,\n        text: str,\n        metadata: dict = None,\n        force_model: str = None\n    ) -> list:\n        \"\"\"\n        Get embedding using appropriate model\n        \n        Args:\n            text: Text to embed\n            metadata: Document metadata (helps with detection)\n            force_model: Force specific model (\"standard_text\" or \"financial_tables\")\n        \n        Returns:\n            Embedding vector\n        \"\"\"\n        # Determine model\n        if force_model:\n            model_type = force_model\n        else:\n            model_type = self.detect_document_type(text, metadata or {})\n        \n        model_config = self.MODELS[model_type]\n        \n        # Call LMStudio embedding endpoint\n        response = requests.post(\n            model_config[\"endpoint\"],\n            json={\n                \"model\": model_config[\"name\"],\n                \"input\": text\n            }\n        )\n        \n        embedding = response.json()[\"data\"][0][\"embedding\"]\n        \n        return embedding, model_type\n\n\n# Usage example\nrouter = EmbeddingRouter()\n\n# Standard article\nembedding, model = router.get_embedding(\n    \"Robert Telus by\u0142 ministrem rolnictwa...\",\n    metadata={\"type\": \"article\", \"source\": \"gazeta.pl\"}\n)\n# Uses: text-embedding-intfloat-multilingual-e5-large-instruct\n\n# Financial PDF\nembedding, model = router.get_embedding(\n    \"Bilans finansowy 2023\\n| Przych\u00f3d | 1,250,000 PLN |\\n| Koszty | 890,000 PLN |\",\n    metadata={\"type\": \"financial\", \"has_tables\": True}\n)\n# Uses: jina-embeddings-v4-text-retrieval\n```\n\n---\n\n## \ud83d\udd12 ACCESS CONTROL\n\n### **Investigation Data Isolation**\n\n```python\nclass DataAccessControl:\n    \"\"\"\n    Enforce separation between project and investigation data\n    \"\"\"\n    \n    UNIVERSES = {\n        \"project\": {\n            \"filesystem\": \"/Users/artur/coursor-agents-destiny-folder/docs/\",\n            \"qdrant_collections\": [\n                \"destiny_project_documentation\",\n                \"destiny_project_code\"\n            ],\n            \"postgres_schema\": \"project\",\n            \"neo4j_label_prefix\": \"Project\",\n            \"redis_key_prefix\": \"project:\",\n            \"access\": [\"system\", \"helena\", \"developers\"]\n        },\n        \"investigation\": {\n            \"filesystem\": \"/Users/artur/coursor-agents-destiny-folder/investigations/\",\n            \"qdrant_collections\": [\n                \"destiny_investigation_sources\",\n                \"destiny_investigation_financial\",\n                \"destiny_investigation_analysis\"\n            ],\n            \"postgres_schema\": \"investigation\",\n            \"neo4j_label_prefix\": \"Investigation\",\n            \"redis_key_prefix\": \"inv:\",\n            \"access\": [\"agents\", \"supervisor\", \"local_llm\"]\n        }\n    }\n    \n    def validate_access(\n        self,\n        requester: str,\n        universe: str,\n        operation: str\n    ) -> bool:\n        \"\"\"\n        Validate if requester can access universe\n        \n        Args:\n            requester: \"helena\", \"agent_elena\", \"local_llm\", \"supervisor\"\n            universe: \"project\" or \"investigation\"\n            operation: \"read\", \"write\", \"delete\"\n        \n        Returns:\n            True if allowed, False otherwise\n        \"\"\"\n        allowed_roles = self.UNIVERSES[universe][\"access\"]\n        \n        # Extract role from requester\n        if requester.startswith(\"agent_\"):\n            role = \"agents\"\n        elif requester == \"local_llm\":\n            role = \"local_llm\"\n        elif requester == \"supervisor\":\n            role = \"supervisor\"\n        elif requester == \"helena\":\n            role = \"helena\"\n        else:\n            role = requester\n        \n        return role in allowed_roles\n    \n    def get_qdrant_collection(\n        self,\n        universe: str,\n        content_type: str = \"standard\"\n    ) -> str:\n        \"\"\"\n        Get appropriate Qdrant collection for data\n        \n        Args:\n            universe: \"project\" or \"investigation\"\n            content_type: \"standard\", \"financial\", \"code\", \"analysis\"\n        \n        Returns:\n            Collection name\n        \"\"\"\n        if universe == \"project\":\n            if content_type == \"code\":\n                return \"destiny_project_code\"\n            else:\n                return \"destiny_project_documentation\"\n        \n        elif universe == \"investigation\":\n            if content_type == \"financial\":\n                return \"destiny_investigation_financial\"\n            elif content_type == \"analysis\":\n                return \"destiny_investigation_analysis\"\n            else:\n                return \"destiny_investigation_sources\"\n        \n        raise ValueError(f\"Unknown universe: {universe}\")\n\n\n# Usage\naccess = DataAccessControl()\n\n# Agent wants to search investigation data\nif access.validate_access(\"agent_elena\", \"investigation\", \"read\"):\n    collection = access.get_qdrant_collection(\"investigation\", \"standard\")\n    # collection = \"destiny_investigation_sources\"\n    # \u2705 Allowed\n\n# Agent wants to search project docs\nif access.validate_access(\"agent_elena\", \"project\", \"read\"):\n    # \u274c Not allowed - agents should only access investigation data\n    pass\n```\n\n---\n\n## \ud83d\udcca MIGRATION PLAN\n\n### **Phase 1: Filesystem Separation (1-2 days)**\n\n1. \u2705 Create new directory structure\n2. \u2705 Move existing investigation data to `/investigations/`\n3. \u2705 Keep `/docs/` strictly for project documentation\n4. \u2705 Update all file paths in code\n5. \u2705 Update Helena watcher to monitor both locations separately\n\n### **Phase 2: Database Separation (2-3 days)**\n\n1. \ud83d\udd28 Create separate Qdrant collections\n2. \ud83d\udd28 Create PostgreSQL schemas (project, investigation)\n3. \ud83d\udd28 Migrate existing data to appropriate schemas\n4. \ud83d\udd28 Update Neo4j to use label prefixes\n5. \ud83d\udd28 Update Redis key patterns\n\n### **Phase 3: Embedding Router (1 day)**\n\n1. \ud83d\udd28 Implement `EmbeddingRouter` class\n2. \ud83d\udd28 Integrate with Qdrant indexing\n3. \ud83d\udd28 Test both embedding models\n4. \ud83d\udd28 Update `local_orchestrator.py` to use router\n\n### **Phase 4: Access Control (1 day)**\n\n1. \ud83d\udd28 Implement `DataAccessControl` class\n2. \ud83d\udd28 Update all data access points\n3. \ud83d\udd28 Add validation at each boundary\n4. \ud83d\udd28 Test isolation\n\n### **Phase 5: Testing & Validation (1-2 days)**\n\n1. \ud83d\udd28 Test complete separation\n2. \ud83d\udd28 Verify no data mixing\n3. \ud83d\udd28 Benchmark performance\n4. \ud83d\udd28 Document usage\n\n**Total Time: 6-9 days**\n\n---\n\n## \ud83c\udfaf SUCCESS CRITERIA\n\n**System is properly separated when:**\n\n1. \u2705 Project docs never appear in investigation queries\n2. \u2705 Investigation data never appears in project searches\n3. \u2705 Each universe uses appropriate embedding model\n4. \u2705 Database queries respect namespace boundaries\n5. \u2705 Filesystem clearly organized (no mixed folders)\n6. \u2705 Access control enforced (agents can't access project internals)\n7. \u2705 Backup/restore can target specific universe\n8. \u2705 Privacy maintained (investigation data isolated)\n\n---\n\n## \ud83d\udcdd CONFIGURATION\n\n### **Update `local_orchestrator.py`:**\n\n```python\n# Local LLM Configuration\nLMSTUDIO_CONFIG = {\n    \"url\": \"http://localhost:1234/v1\",\n    \"model_name\": \"gpt-oss-20b\",\n    \"context_window\": 44000,  # 44k tokens\n    \"temperature\": 0.7,\n    \"max_tokens\": 2048\n}\n\n# Embedding Configuration\nEMBEDDING_CONFIG = {\n    \"standard_text\": {\n        \"model\": \"text-embedding-intfloat-multilingual-e5-large-instruct\",\n        \"use_for\": [\"text\", \"articles\", \"reports_no_tables\"]\n    },\n    \"financial_tables\": {\n        \"model\": \"jina-embeddings-v4-text-retrieval\",\n        \"use_for\": [\"financial_pdf\", \"tables\", \"structured_data\"]\n    }\n}\n\n# Data Separation\nDATA_UNIVERSES = {\n    \"project\": {\n        \"root\": \"/Users/artur/coursor-agents-destiny-folder/docs/\",\n        \"access\": \"read-only\"  # Agents can't modify project\n    },\n    \"investigation\": {\n        \"root\": \"/Users/artur/coursor-agents-destiny-folder/investigations/\",\n        \"access\": \"read-write\"  # Agents work here\n    }\n}\n```\n\n---\n\n## \ud83d\ude80 NEXT STEPS\n\n**Priority 1 (This Week):**\n1. Create investigation directory structure\n2. Update `local_orchestrator.py` with your LMStudio config\n3. Implement `EmbeddingRouter`\n4. Test with one investigation\n\n**Priority 2 (Next Week):**\n1. Create separate database schemas/collections\n2. Migrate existing data\n3. Implement access control\n4. Full testing\n\n**Powiedz s\u0142owo, a implementuj\u0119!** \ud83c\udfaf\n",
  "indexed_at": "2025-11-04T19:40:02.154275",
  "source": "realtime_watcher"
}